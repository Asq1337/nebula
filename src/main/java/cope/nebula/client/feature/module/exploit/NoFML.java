package cope.nebula.client.feature.module.exploit;

import cope.nebula.client.events.PacketEvent;
import cope.nebula.client.events.PacketEvent.Direction;
import cope.nebula.client.feature.module.Module;
import cope.nebula.client.feature.module.ModuleCategory;
import cope.nebula.client.value.Value;
import net.minecraft.network.play.client.CPacketCustomPayload;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.network.internal.FMLProxyPacket;

public class NoFML extends Module {
    public NoFML() {
        super("NoFML", ModuleCategory.EXPLOIT, "Prevents forge from reporting to servers you're on forge");
    }

    public static final Value<Brand> brand = new Value<>("Brand", Brand.VANILLA);

    @SubscribeEvent
    public void onPacket(PacketEvent event) {
        if (event.getDirection().equals(Direction.OUTGOING)) {
            if (event.getPacket() instanceof FMLProxyPacket && !mc.isSingleplayer()) {
                event.setCanceled(true);
            }

            if (event.getPacket() instanceof CPacketCustomPayload) {
                CPacketCustomPayload packet = event.getPacket();
                if (packet.getChannelName().equalsIgnoreCase("MC|Brand")) {
                    packet.getBufferData().clear();
                    packet.getBufferData().writeString(brand.getValue().value);
                }
            }
        }
    }

    public enum Brand {
        LUNAR("lunar-client"),
        VANILLA("vanilla");

        private final String value;

        Brand(String value) {
            this.value = value;
        }
    }
}
